{% extends "base.html" %}

{% block title %}Dashboard - STARBLUE{% endblock %}

{% block extra_css %}
<style>
/* =========================
   DASHBOARD – MOBILE-FIRST
   ========================= */

/* Base + tokens (keeps your palette/look) */
:root {
  --sky-50:#f6faff;
  --sky-100:#e6f2fa;
  --sky-200:#e3f2fd;
  --sky-300:#c1eafb;
  --sky-400:#b5e0ff;
  --sky-500:#87ceeb;
  --sky-600:#6fd1fb;
  --sky-700:#4682B4;
  --ink-700:#144e75;
  --ink-600:#2174a0;
  --ink-500:#2675c8;
  --ink-400:#4d6786;
  --ink-300:#738ca6;
  --ring:#b5e0ff;
}

/* Fluid type & spacing helpers */
html { font-size: 100%; }
body, .dashboard-page { background: var(--sky-50); }
h1, .display-6 { font-size: clamp(1.5rem, 2.2vw + 1rem, 2.2rem); }
h5, h6 { line-height: 1.25; }
.lead { font-size: clamp(.95rem, .6vw + .8rem, 1.12rem); }

* { min-width: 0; }

/* =========================
   Header
   ========================= */
.dashboard-header {
  background: linear-gradient(135deg, var(--sky-400) 0%, var(--sky-600) 100%);
  color: var(--ink-700);
  border-bottom: 1px solid var(--sky-100);
  box-shadow: 0 2px 8px rgba(44,121,207,.05);
}
.dashboard-header h1 {
  color: var(--ink-700);
  text-shadow: 0 2px 12px rgba(255,255,255,.2);
}

/* Action button area stacks on small screens */
.dashboard-actions .btn { white-space: nowrap; }
@media (max-width: 576px) {
  .dashboard-actions {
    display: flex; gap: .75rem; justify-content: flex-start;
    margin-top: .5rem;
  }
  .dashboard-actions .btn { width: 100%; }
}

/* =========================
   Stat Cards
   ========================= */
.stat-card {
  background: linear-gradient(138deg,#fff 65%, var(--sky-200) 100%);
  border-radius: 1rem;
  border: 1px solid var(--sky-100);
  box-shadow: 0 2px 18px rgba(108,188,247,.09);
  display: flex; align-items: center; gap: 1rem;
  padding: clamp(1rem, 2vw, 2rem) 1rem;
  height: 100%;
  transition: transform .2s ease, box-shadow .2s ease, opacity .2s ease;
  opacity: .97;
}
.stat-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 4px 24px rgba(108,188,247,.16);
  opacity: 1;
}
/* Tone down hover scaling on touch devices */
@media (hover: none) {
  .stat-card:hover { transform: none; }
}
.stat-icon {
  width: 56px; height: 56px; min-width: 56px;
  background: linear-gradient(135deg, #dff3ff 0%, var(--sky-500) 100%);
  border-radius: 50%;
  display: grid; place-items: center;
  border: 2px solid #e4f4fe;
  box-shadow: 0 2px 8px rgba(87,206,235,.08);
}
.stat-icon i { font-size: 1.6rem; color: #3fbaf3; }
.stat-number {
  font-size: clamp(1.25rem, 1.2vw + 1rem, 2rem);
  font-weight: 800; margin: 0; color: var(--ink-700);
}
.stat-label {
  color: var(--ink-400); font-size: .95rem; font-weight: 600; margin: 0;
}

/* =========================
   Cards
   ========================= */
.card {
  border-radius: 1rem;
  border: 1px solid #e3eaf5;
  background: #fff;
  box-shadow: 0 2px 14px rgba(59,128,180,.06);
  overflow: hidden;
}
.card-header {
  background: linear-gradient(135deg,#ebf8ff 60%, #f3fafd 100%);
  border-bottom: 1px solid #f0f7fd;
  color: var(--ink-600);
  font-weight: 700;
}
.card-body { background: #fbfcfe; }

/* =========================
   Recent Bookings
   ========================= */
.booking-list { display: grid; gap: .65rem; }
.booking-item {
  border: 1px solid #eef3f9;
  padding: .9rem;
  background: rgba(130,190,241,.05);
  border-radius: .8rem;
  transition: box-shadow .15s ease, background .15s ease;
}
.booking-item:hover {
  box-shadow: 0 4px 8px rgba(45,152,219,.12);
  background: rgba(130,190,241,.10);
}
.transport-icon {
  width: 36px; height: 36px; border-radius: 50%;
  display: grid; place-items: center; margin-inline: auto;
  background: linear-gradient(135deg,#e5f3fd 60%, #f3fafd 100%);
}
.transport-icon i { font-size: 1.15rem; color: var(--sky-500); }
.booking-route h6 { color: var(--ink-600); font-weight: 700; margin: 0; }
.booking-route small { color: var(--ink-300); }
.booking-date p { margin: 0; color: var(--ink-500); font-weight: 700; }
.booking-date small { color: #8baec9; }
.booking-status .badge {
  font-size: .9rem; padding: .45em .75em; border-radius: .6rem;
  font-weight: 700; letter-spacing: .01em;
  box-shadow: 0 2px 8px rgba(87,206,235,.07);
}
.booking-actions .btn { width: 100%; }

/* Make booking row layout adapt on small screens */
@media (max-width: 768px) {
  .booking-item .row > [class^="col-"] { margin-top: .35rem; }
  .booking-item .row { row-gap: .25rem; }
}

/* =========================
   Empty State
   ========================= */
.empty-state {
  background: #f8fcff;
  border-radius: 1rem;
  padding: clamp(1rem, 2.5vw, 2rem);
  box-shadow: 0 1px 8px rgba(114,205,246,.07);
}

/* =========================
   Quick Actions
   ========================= */
.quick-action-card {
  background: linear-gradient(135deg,#fafdff 80%, var(--sky-300) 100%);
  border: 1px solid #e3eaf5;
  border-radius: .9rem;
  text-decoration: none;
  color: var(--ink-600);
  box-shadow: 0 2px 6px rgba(87,206,235,.06);
  transition: transform .18s ease, box-shadow .18s ease, background .18s ease;
  padding: 1rem .9rem;
  display: block;
  height: 100%;
}
.quick-action-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 24px rgba(108,188,247,.15);
}
.quick-action-icon { text-align: center; margin-bottom: .6rem; }
.quick-action-icon i { font-size: 1.4rem; color: #50b1e6; }
.quick-action-content h6 {
  margin: 0 0 .25rem; font-weight: 800; color: var(--ink-500);
}
.quick-action-content p { margin: 0; color: #7da5bb; }

/* =========================
   Sidebar (Profile)
   ========================= */
.avatar-circle {
  width: 64px; height: 64px;
  background: linear-gradient(135deg, #7ecbfa 0%, #266baf 100%);
  color: #fff; border-radius: 50%;
  display: grid; place-items: center;
  font-size: 1.35rem; font-weight: 800;
  margin: 0 auto .35rem; border: 2px solid #d1eafd;
  box-shadow: 0 2px 8px rgba(87,206,235,.12);
}
.profile-avatar h6 { color: #104c8c; }
.profile-details .detail-item {
  display: grid; grid-template-columns: 20px 1fr; align-items: start;
  gap: .6rem; margin-bottom: .4rem; color: var(--ink-400);
}
.profile-details .detail-item i { color: #8bbdd7; }

/* =========================
   Offers & Tips
   ========================= */
.offer-list, .tip-list { display: grid; gap: .85rem; margin: 0; }
.offer-item, .tip-item { display: grid; grid-template-columns: 42px 1fr; gap: .85rem; }
.offer-icon {
  width: 42px; height: 42px; border-radius: 50%;
  display: grid; place-items: center; background: #e9f8ff;
}
.offer-icon i { color: var(--sky-500); font-size: 1.1rem; }
.offer-content h6, .tip-item h6 { color: var(--ink-600); margin: 0 0 .15rem; }
.offer-content p, .offer-content small, .tip-item p, .tip-item small { color: #7da5bb; margin: 0; }

/* Keep your gradient helpers */
.bg-success { background: linear-gradient(135deg,#b8ebcd 60%, #47d09a 100%)!important;}
.bg-info    { background: linear-gradient(135deg,#c1ebf7 60%, #33cfff 100%)!important;}
.text-purple{ color: #a97fef !important; }
.text-warning{ color: #FFA726 !important; }
.text-muted { color: #93b5cf !important; }

/* =========================
   Buttons
   ========================= */
.btn, .btn-lg, .btn-sm { font-weight: 700; border-radius: .5rem; }
.btn-primary, .btn-outline-primary {
  background: linear-gradient(135deg, var(--sky-600) 0%, #266baf 100%);
  color: #fff; border: none;
}
.btn-outline-primary {
  background: #fff !important;
  color: #266baf !important;
  border: 2px solid var(--ring) !important;
}
.btn-outline-primary:hover, .btn-primary:hover {
  background: linear-gradient(135deg, #266baf 0%, var(--sky-600) 100%) !important;
  color: #fff !important; border: none;
  box-shadow: 0 2px 18px rgba(87,206,235,.19);
}
.btn-light {
  background: #edf7fa; color: var(--ink-600);
  border: 1.3px solid #d1eafd; font-weight: 800;
}

/* =========================
   Layout Tweaks
   ========================= */
.dashboard-stats .row > [class*="col-"] { display: grid; }
@media (max-width: 992px) {
  .stat-card { padding: 1.2rem; }
}
@media (max-width: 768px) {
  .stat-card, .card, .quick-action-card, .offer-item, .tip-item {
    border-radius: .75rem;
  }
  .dashboard-header, .dashboard-stats, .dashboard-content {
    padding-left: 0 !important; padding-right: 0 !important;
  }
}
@media (max-width: 576px) {
  .booking-actions .btn { padding: .5rem .65rem; }
  .card-header { padding: .75rem 1rem; }
  .card-body { padding: 1rem; }
}

/* =========================
   Accessibility / Motion / Dark
   ========================= */
@media (prefers-reduced-motion: reduce) {
  * { animation: none !important; transition: none !important; }
}
@media (prefers-color-scheme: dark) {
  body, .dashboard-page { background: #0f172a; }
  .dashboard-header {
    background: linear-gradient(135deg, #1e293b 0%, #0b5ea8 100%);
    color: #e5f0ff;
  }
  .stat-card, .card, .contact-card {
    background: #111827; border-color: #1f2a37; box-shadow: none;
  }
  .card-header { background: #0b1220; border-bottom-color: #192133; color: #b9d7ff; }
  .stat-number, .booking-route h6, .quick-action-content h6 { color: #dbeafe; }
  .stat-label, .lead, .profile-details .detail-item, .offer-content p, .tip-item p { color: #9fb6d1; }
  .booking-item { background: #0b1220; border-color: #1b283a; }
  .quick-action-card { background: #0b1220; border-color: #1b283a; }
  .btn-light { background: #1f2937; color: #e5f0ff; border-color: #334155; }
}
</style>

{% endblock %}


{% block content %}
<div class="dashboard-page">
    <!-- Dashboard Header -->
    <section class="dashboard-header py-4 bg-gradient-primary text-white">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-8">
                    <h1 class="display-6 fw-bold mb-2">
                        Welcome back, {% if current_user %}{{ current_user.username }}{% else %}Guest{% endif %}!
                    </h1>
                    <p class="lead mb-0">Manage your bookings and explore new destinations</p>
                </div>
                <div class="col-lg-4 text-lg-end">
                    <div class="dashboard-actions">
                        <a href="{{ url_for('search') }}" class="btn btn-light btn-lg">
                            <i class="fas fa-plus me-2"></i>New Booking
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Dashboard Stats -->
    <section class="dashboard-stats py-4 bg-light">
        <div class="container">
            <div class="row g-4">
                <div class="col-lg-3 col-md-6">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-ticket-alt"></i>
                        </div>
                        <div class="stat-content">
                            <h3 class="stat-number">{{ bookings|length if bookings else 0 }}</h3>
                            <p class="stat-label">Total Bookings</p>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-3 col-md-6">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-rupee-sign"></i>
                        </div>
                        <div class="stat-content">
                            <h3 class="stat-number">₹{{ "{:,.0f}".format(bookings|sum(attribute='total_amount')|float) if bookings else 0 }}</h3>
                            <p class="stat-label">Total Spent</p>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-3 col-md-6">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <div class="stat-content">
                            <h3 class="stat-number">{{ bookings[:5]|length if bookings else 0 }}</h3>
                            <p class="stat-label">Recent Trips</p>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-3 col-md-6">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-star"></i>
                        </div>
                        <div class="stat-content">
                            <h3 class="stat-number">Gold</h3>
                            <p class="stat-label">Member Status</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Dashboard Content -->
    <section class="dashboard-content py-5">
        <div class="container">
            <div class="row">
                <div class="col-lg-8">
                    <!-- Recent Bookings -->
                    <div class="card mb-4">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">
                                <i class="fas fa-clock me-2"></i>Recent Bookings
                            </h5>
                            <a href="{{ url_for('manage_booking', booking_id='all') }}" class="btn btn-outline-primary btn-sm">
                                View All
                            </a>
                        </div>
                        <div class="card-body">
                            {% if bookings %}
                                <div class="booking-list">
                                    {% for booking in bookings[:5] %}
                                    <div class="booking-item">
                                        <div class="row align-items-center">
                                            <div class="col-md-1">
                                                <div class="transport-icon">
                                                    <i class="fas fa-{{ 'plane' if booking.transport_type == 'flight' else 'train' if booking.transport_type == 'train' else 'bus' }}" style="color: #87CEEB;"></i>
                                                </div>
                                            </div>
                                            
                                            <div class="col-md-4">
                                                <div class="booking-route">
                                                    <h6 class="mb-1">{{ booking.from_location or 'N/A' }} → {{ booking.to_location or 'N/A' }}</h6>
                                                    <small class="text-muted">{{ booking.transport_type|title }} • {{ booking.booking_id }}</small>
                                                </div>
                                            </div>
                                            
                                            <div class="col-md-3">
                                                <div class="booking-date">
                                                    <p class="mb-0 fw-bold">{{ booking.travel_date.strftime('%d %b %Y') if booking.travel_date else 'TBD' }}</p>
                                                    <small class="text-muted">{{ booking.departure_time or 'TBD' }}</small>
                                                </div>
                                            </div>
                                            
                                            <div class="col-md-2">
                                                <div class="booking-status">
                                                    <span class="badge bg-{{ 'success' if booking.status == 'Confirmed' else 'danger' if booking.status == 'Cancelled' else 'warning' }}">
                                                        {{ booking.status|title }}
                                                    </span>
                                                </div>
                                            </div>
                                            
                                            <div class="col-md-2">
                                                <div class="booking-actions">
                                                    <a href="{{ url_for('manage_booking', booking_id=booking.booking_id) }}" class="btn btn-outline-primary btn-sm">
                                                        <i class="fas fa-eye me-1"></i>View
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <div class="empty-state text-center py-4">
                                    <i class="fas fa-ticket-alt fa-3x text-muted mb-3"></i>
                                    <h5>No bookings yet</h5>
                                    <p class="text-muted">Start your journey by booking your first trip!</p>
                                    <a href="{{ url_for('search') }}" class="btn btn-primary">
                                        <i class="fas fa-plus me-2"></i>Book Now
                                    </a>
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">
                                <i class="fas fa-bolt me-2"></i>Quick Actions
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <a href="{{ url_for('search') }}" class="quick-action-card">
                                        <div class="quick-action-icon">
                                            <i class="fas fa-search"></i>
                                        </div>
                                        <div class="quick-action-content">
                                            <h6>Search & Book</h6>
                                            <p class="small text-muted">Find and book your next trip</p>
                                        </div>
                                    </a>
                                </div>
                                
                                <div class="col-md-4">
                                    <a href="{{ url_for('track') }}" class="quick-action-card">
                                        <div class="quick-action-icon">
                                            <i class="fas fa-map-marker-alt"></i>
                                        </div>
                                        <div class="quick-action-content">
                                            <h6>Track Journey</h6>
                                            <p class="small text-muted">Track your current bookings</p>
                                        </div>
                                    </a>
                                </div>
                                
                                <div class="col-md-4">
                                    <a href="{{ url_for('contact') }}" class="quick-action-card">
                                        <div class="quick-action-icon">
                                            <i class="fas fa-headset"></i>
                                        </div>
                                        <div class="quick-action-content">
                                            <h6>Support</h6>
                                            <p class="small text-muted">Get help and support</p>
                                        </div>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Sidebar -->
                <div class="col-lg-4">
                    <!-- Profile Summary -->
                    <div class="card mb-4">
                        <div class="card-header text-white" style="background: linear-gradient(135deg, #87CEEB 0%, #4682B4 100%);">
                            <h6 class="mb-0">
                                <i class="fas fa-user me-2"></i>Profile Summary
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="profile-info">
                                <div class="profile-avatar text-center mb-3">
                                    <div class="avatar-circle">
                                        {% if current_user and current_user.username %}
                                            {{ current_user.username[0]|upper }}{{ current_user.username[1]|upper if current_user.username|length > 1 else '' }}
                                        {% else %}
                                            GU
                                        {% endif %}
                                    </div>
                                    <h6 class="mt-2 mb-0">{% if current_user %}{{ current_user.username }}{% else %}Guest User{% endif %}</h6>
                                    <small class="text-muted">{% if current_user %}{{ current_user.email }}{% else %}guest@example.com{% endif %}</small>
                                </div>
                                
                                <div class="profile-details">
                                    <div class="detail-item">
                                        <i class="fas fa-phone text-muted me-2"></i>
                                        <span>{% if current_user and current_user.phone %}{{ current_user.phone }}{% else %}Not provided{% endif %}</span>
                                    </div>
                                    <div class="detail-item">
                                        <i class="fas fa-calendar text-muted me-2"></i>
                                        <span>Member since {% if current_user and current_user.created_at %}{{ current_user.created_at.strftime('%B %Y') }}{% else %}Recently{% endif %}</span>
                                    </div>
                                    <div class="detail-item">
                                        <i class="fas fa-star text-warning me-2"></i>
                                        <span>Gold Member</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Offers & Deals -->
                    <div class="card mb-4">
                        <div class="card-header bg-success text-white">
                            <h6 class="mb-0">
                                <i class="fas fa-tags me-2"></i>Exclusive Offers
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="offer-list">
                                <div class="offer-item">
                                    <div class="offer-icon">
                                        <i class="fas fa-plane" style="color: #87CEEB;"></i>
                                    </div>
                                    <div class="offer-content">
                                        <h6 class="mb-1">Flight Sale</h6>
                                        <p class="small text-muted mb-1">Up to 40% off on domestic flights</p>
                                        <small class="text-success">Valid till Dec 31</small>
                                    </div>
                                </div>
                                
                                <div class="offer-item">
                                    <div class="offer-icon">
                                        <i class="fas fa-train" style="color: #87CEEB;"></i>
                                    </div>
                                    <div class="offer-content">
                                        <h6 class="mb-1">Train Booking</h6>
                                        <p class="small text-muted mb-1">Flat ₹200 off on train bookings</p>
                                        <small class="text-success">Code: TRAIN200</small>
                                    </div>
                                </div>
                                
                                <div class="offer-item">
                                    <div class="offer-icon">
                                        <i class="fas fa-bus" style="color: #87CEEB;"></i>
                                    </div>
                                    <div class="offer-content">
                                        <h6 class="mb-1">Bus Travel</h6>
                                        <p class="small text-muted mb-1">25% off on luxury bus bookings</p>
                                        <small class="text-success">Code: LUXURY25</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Travel Tips -->
                    <div class="card">
                        <div class="card-header bg-info text-white">
                            <h6 class="mb-0">
                                <i class="fas fa-lightbulb me-2"></i>Travel Tips
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="tip-list">
                                <div class="tip-item">
                                    <h6 class="mb-1">Book in Advance</h6>
                                    <p class="small text-muted">Save up to 30% by booking 2-3 weeks ahead</p>
                                </div>
                                
                                <div class="tip-item">
                                    <h6 class="mb-1">Travel Light</h6>
                                    <p class="small text-muted">Pack smart to avoid extra baggage charges</p>
                                </div>
                                
                                <div class="tip-item">
                                    <h6 class="mb-1">Check Weather</h6>
                                    <p class="small text-muted">Always check destination weather before travel</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>
{% endblock %}

{% block extra_js %}
<script>
function contactSupport() {
    window.location.href = '{{ url_for("contact") }}';
}

// Auto-refresh dashboard data every 5 minutes
setInterval(function() {
    console.log('Refreshing dashboard data...');
}, 300000);

// Welcome animation
document.addEventListener('DOMContentLoaded', function() {
    const statCards = document.querySelectorAll('.stat-card');
    statCards.forEach((card, index) => {
        setTimeout(() => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            card.style.transition = 'all 0.5s ease';
            
            setTimeout(() => {
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, 100);
        }, index * 100);
    });
});
</script>
{% endblock %}
