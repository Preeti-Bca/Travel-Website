<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reports & Analytics - PURA ALL CONTROL</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
/* =========================================================
   Reports – Mobile-first, fully responsive CSS
   (drop-in replacement for your existing <style> block)
   ========================================================= */

/* Theme tokens */
:root{
  --bg:#f7f8fa;
  --panel:#ffffff;
  --panel-soft:#f4f7fb;
  --text:#1b2230;
  --muted:#6b7280;
  --brand:#3047ce;
  --brand-2:#193396;
  --accent:#2390b4;
  --good:#1cae54;
  --warn:#f59e0b;
  --bad:#ef4444;
  --shadow:0 2px 8px rgba(23,48,100,.08);
  --radius:16px;
}

/* Base */
body.admin-body{
  font-family:'Segoe UI', Arial, sans-serif;
  background:var(--bg);
  color:var(--text);
  margin:0;
  min-height:100vh;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}
*{box-sizing:border-box}

/* Layout */
.admin-container{display:flex;min-height:100vh}

/* Sidebar — desktop default */
.admin-sidebar{
  width:260px;
  background:#212a33;
  color:#fff;
  padding:20px 16px;
  box-shadow:2px 0 10px rgba(9,30,66,.08);
  position:sticky;
  top:0;
  height:100vh;
  overflow-y:auto;
}

/* Main */
.admin-main{
  flex:1;
  padding:24px 20px;
  min-height:100vh;
}

/* Header */
.admin-header{
  display:flex;
  gap:16px;
  justify-content:space-between;
  align-items:center;
  background:var(--panel);
  border-radius:var(--radius);
  padding:14px 16px;
  box-shadow:0 1px 3px rgba(20,40,90,.05);
  margin-bottom:20px;
}
.header-left{display:flex;align-items:center;gap:12px}
.header-left h1{font-size:1.125rem;margin:0}
.sidebar-toggle{
  border:0;background:#e6eaef;color:var(--brand);
  width:40px;height:40px;border-radius:10px;
  display:inline-grid;place-items:center;cursor:pointer;
}
.header-right{display:flex;align-items:center;gap:12px;flex-wrap:wrap}

/* Date range */
.date-range-picker{
  display:flex;align-items:center;gap:8px;
  background:#f0f3f9;border-radius:10px;padding:6px 8px;
}
.date-range-picker input[type="date"]{
  border:0;background:#e8eaed;border-radius:6px;
  padding:6px 10px;color:#495f7e;font-size:.95rem;outline:0;
}

/* Buttons */
.btn{
  border:none;border-radius:10px;padding:10px 14px;
  cursor:pointer;font-weight:600;transition:.2s;
  display:inline-flex;align-items:center;gap:8px;
}
.btn.btn-primary{background:var(--brand);color:#fff}
.btn.btn-primary:hover{background:var(--brand-2)}
.btn.btn-secondary{background:#e6eaef;color:var(--brand)}
.btn.btn-secondary:hover{background:#dce3ec;color:#0f1e8c}

/* Sidebar internals */
.sidebar-header{display:flex;align-items:center;gap:10px;margin-bottom:12px}
.sidebar-logo{width:40px;height:40px;border-radius:8px;background:#2a3542;object-fit:cover}
.sidebar-header h2{font-size:1rem;margin:0;font-weight:700}
.sidebar-menu{list-style:none;margin:0;padding:0}
.sidebar-menu li{margin-bottom:6px}
.sidebar-menu a{
  display:flex;align-items:center;gap:10px;
  text-decoration:none;color:#b5bac8;
  padding:10px 10px;border-radius:10px;
  transition:background .18s,color .18s;
}
.sidebar-menu a.active,
.sidebar-menu li.active a,
.sidebar-menu a:hover{background:#294154;color:#fff}
.menu-icon{width:20px;height:20px;object-fit:contain}

/* Profile */
.admin-profile{
  display:flex;align-items:center;gap:8px;background:#f0f3f9;
  padding:6px 10px;border-radius:12px;
}
.admin-profile .profile-img{width:28px;height:28px;border-radius:50%;object-fit:cover}
.logout-btn{color:var(--brand);text-decoration:none}

/* Tabs (scrollable on mobile) */
.report-tabs{
  display:flex;gap:8px;margin:16px 0 20px;overflow-x:auto;padding-bottom:2px;
  scrollbar-width:thin;
}
.tab-btn{
  flex:0 0 auto;background:#f0f3fa;border:0;border-radius:10px 10px 0 0;
  padding:10px 14px;color:#637093;font-weight:700;cursor:pointer;
}
.tab-btn.active,.tab-btn:focus{background:#fff;color:var(--brand);border-bottom:2px solid var(--brand)}

/* Panels */
.report-section{
  background:var(--panel);border-radius:var(--radius);box-shadow:var(--shadow);
  padding:16px 14px;margin-bottom:18px;
}
.section-header{
  display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap;
}
.section-header h3{margin:0;font-size:1rem}

/* Cards containers (wrap on all screens, auto-fit columns on larger) */
.revenue-stats,
.booking-metrics,
.customer-stats,
.performance-metrics{
  display:grid;gap:12px;margin:10px 0 8px;
  grid-template-columns:repeat(auto-fit,minmax(170px,1fr));
}

/* Card */
.revenue-card,
.metric-card,
.segment-card,
.performance-card,
.stat-item{
  background:var(--panel-soft);border-radius:12px;padding:14px;
  box-shadow:0 1px 3px rgba(76,112,160,.04);
}

/* Icons */
.revenue-icon,.performance-icon{font-size:1.25rem;color:var(--brand);margin-bottom:6px}

/* Chart containers (responsive) */
.chart-container{
  background:#fcfdff;border-radius:12px;padding:12px;
  box-shadow:0 1px 2px rgba(76,112,160,.03);
  margin-top:10px;min-height:220px; /* Chart.js will stretch to fill */
}
.chart-container canvas{width:100% !important;height:100% !important;max-height:420px}

/* Small inline metric charts */
.metric-chart canvas,
.segment-chart canvas{width:100% !important;height:60px !important}

/* Route list */
.routes-list{display:flex;flex-direction:column;gap:10px;margin-top:8px}
.route-item{
  display:flex;gap:12px;justify-content:space-between;align-items:center;
  background:#f4f6fa;border-radius:10px;padding:10px 12px;
}
.route-info{display:flex;flex-direction:column;font-size:.95rem}
.route-type{color:var(--muted);font-size:.8rem}
.route-stats{display:flex;align-items:center;gap:10px;min-width:160px}
.progress-bar{width:120px;background:#e6ecfa;border-radius:999px;height:8px;overflow:hidden}
.progress{background:var(--brand);height:100%;border-radius:999px;transition:width .8s}

/* Status / Growth */
.growth{font-weight:700;font-size:.95rem;margin-top:2px}
.growth.positive{color:var(--good)}
.growth.negative{color:#f35d2a}
.status{padding:2px 10px;border-radius:999px;font-size:.8rem;margin-left:6px}
.status.good{background:#e7f7ef;color:var(--good)}
.status.excellent{background:#eaf4f7;color:var(--accent)}
.status.normal{background:#ecf1fa;color:var(--brand)}

/* Two-up charts area in Performance */
.performance-charts{
  display:grid;gap:12px;margin-top:12px;
  grid-template-columns:1fr;
}

/* Accessibility & focus */
:focus-visible{outline:3px solid rgba(48,71,206,.35);outline-offset:2px}
@media (prefers-reduced-motion:reduce){
  *{transition:none !important;animation:none !important}
}

/* ---------------------------
   RESPONSIVE BREAKPOINTS
   --------------------------- */

/* ≥576px */
@media (min-width:576px){
  .admin-main{padding:28px}
  .section-header h3{font-size:1.05rem}
}

/* ≥768px */
@media (min-width:768px){
  .admin-main{padding:32px}
  .header-left h1{font-size:1.25rem}
  .performance-charts{grid-template-columns:1fr 1fr}
}

/* ≥992px */
@media (min-width:992px){
  .admin-main{padding:36px 40px}
  .report-section{padding:18px 18px}
}

/* ≤991px — compact the sidebar */
@media (max-width:991.98px){
  .admin-sidebar{width:72px;padding:16px 8px}
  .sidebar-header h2,.sidebar-menu span{display:none}
  .sidebar-menu a{justify-content:center}
}

/* ≤767px — Off-canvas sidebar */
@media (max-width:767.98px){
  .admin-container{position:relative}
  .admin-sidebar{
    position:fixed;left:-100%;top:0;bottom:0;z-index:999;
    width:min(80vw,300px);height:100vh;padding:20px 16px;
    transition:left .25s ease;
  }
  /* When <body> has .sidebar-open, show the sidebar */
  body.sidebar-open .admin-sidebar{left:0}
  /* Backdrop */
  body.sidebar-open::after{
    content:"";position:fixed;inset:0;background:rgba(17,24,39,.45);
    z-index:998;
  }

  .admin-main{padding:16px}
  .admin-header{align-items:stretch}
  .header-left h1{font-size:1.1rem}
  .route-item{flex-direction:column;align-items:flex-start}
  .route-stats{width:100%;justify-content:space-between}
}

/* Tiny screens */
@media (max-width:420px){
  .date-range-picker{width:100%}
  .date-range-picker input[type="date"]{flex:1}
  .btn{padding:9px 12px}
}

/* Optional dark mode (respects system) */
@media (prefers-color-scheme:dark){
  :root{--bg:#0f1724;--panel:#111827;--panel-soft:#0f1a2b;--text:#e5e7eb;--muted:#9ca3af}
  .admin-header,.report-section{box-shadow:none}
  .sidebar-menu a{color:#9aa4b1}
  .sidebar-menu a:hover,.sidebar-menu a.active{color:#fff}
  .date-range-picker{background:#0f1a2b}
  .date-range-picker input[type="date"]{background:#0d1422;color:#d1d5db}
  .admin-profile{background:#0f1a2b}
  .progress-bar{background:#1f2a44}
}
</style>
<script>
  document.querySelector('.sidebar-toggle')?.addEventListener('click',()=>{
    document.body.classList.toggle('sidebar-open');
  });
  // close on backdrop tap
  document.addEventListener('click',e=>{
    if(document.body.classList.contains('sidebar-open') && e.target===document.body){ 
      document.body.classList.remove('sidebar-open');
    }
  });
</script>

</head>
<body class="admin-body">
    <div class="admin-container">
        <!-- Sidebar -->
        <nav class="admin-sidebar">
            <div class="sidebar-header">
                <img src="{{ url_for('static', filename='images/clipart/admin-dashboard.png') }}" alt="Admin" class="sidebar-logo">
                <h2>PURA CONTROL</h2>
            </div>
            <ul class="sidebar-menu">
                <li>
                    <a href="{{ url_for('admin_dashboard') }}">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li>
                    <a href="{{ url_for('admin_bookings') }}">
                        <img src="{{ url_for('static', filename='images/clipart/booking-management.png') }}" alt="Bookings" class="menu-icon">
                        <span>Bookings</span>
                    </a>
                </li>
                <li>
                    <a href="{{ url_for('admin_users') }}">
                        <img src="{{ url_for('static', filename='images/clipart/users-management.png') }}" alt="Users" class="menu-icon">
                        <span>Users</span>
                    </a>
                </li>
                <li>
                    <a href="{{ url_for('admin_flights') }}">
                        <img src="{{ url_for('static', filename='images/clipart/flight-admin.png') }}" alt="Flights" class="menu-icon">
                        <span>Flights</span>
                    </a>
                </li>
                <li>
                    <a href="{{ url_for('admin_trains') }}">
                        <img src="{{ url_for('static', filename='images/clipart/train-admin.png') }}" alt="Trains" class="menu-icon">
                        <span>Trains</span>
                    </a>
                </li>
                <li>
                    <a href="{{ url_for('admin_buses') }}">
                        <img src="{{ url_for('static', filename='images/clipart/bus-admin.png') }}" alt="Buses" class="menu-icon">
                        <span>Buses</span>
                    </a>
                </li>
                <li class="active">
                    <a href="{{ url_for('admin_reports') }}">
                        <img src="{{ url_for('static', filename='images/clipart/reports-analytics.png') }}" alt="Reports" class="menu-icon">
                        <span>Reports</span>
                    </a>
                </li>
                <li>
                    <a href="{{ url_for('admin_settings') }}">
                        <img src="{{ url_for('static', filename='images/clipart/settings-config.png') }}" alt="Settings" class="menu-icon">
                        <span>Settings</span>
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="admin-main">
            <header class="admin-header">
                <div class="header-left">
                    <button class="sidebar-toggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1>Reports & Analytics</h1>
                </div>
                <div class="header-right">
                    <div class="date-range-picker">
                        <input type="date" id="startDate" value="2024-01-01">
                        <span>to</span>
                        <input type="date" id="endDate" value="2024-12-31">
                        <button class="btn btn-primary" onclick="updateReports()">
                            <i class="fas fa-sync"></i>
                            Update
                        </button>
                    </div>
                    <div class="admin-profile">
                        <img src="{{ url_for('static', filename='images/clipart/admin-dashboard.png') }}" alt="Admin" class="profile-img">
                        <span>Super Admin</span>
                        <a href="{{ url_for('logout') }}" class="logout-btn">
                            <i class="fas fa-sign-out-alt"></i>
                        </a>
                    </div>
                </div>
            </header>

            <div class="reports-content">
                <!-- Report Categories -->
                <div class="report-tabs">
                    <button class="tab-btn active" onclick="showTab('revenue')">
                        <i class="fas fa-dollar-sign"></i>
                        Revenue Analytics
                    </button>
                    <button class="tab-btn" onclick="showTab('bookings')">
                        <i class="fas fa-chart-line"></i>
                        Booking Analytics
                    </button>
                    <button class="tab-btn" onclick="showTab('customers')">
                        <i class="fas fa-users"></i>
                        Customer Analytics
                    </button>
                    <button class="tab-btn" onclick="showTab('performance')">
                        <i class="fas fa-tachometer-alt"></i>
                        Performance
                    </button>
                </div>

                <!-- Revenue Analytics Tab -->
                <div class="tab-content active" id="revenue">
                    <div class="report-section">
                        <div class="section-header">
                            <h3>Revenue Overview</h3>
                            <div class="export-buttons">
                                <button class="btn btn-secondary" onclick="exportReport('revenue', 'pdf')">
                                    <i class="fas fa-file-pdf"></i>
                                    PDF
                                </button>
                                <button class="btn btn-secondary" onclick="exportReport('revenue', 'excel')">
                                    <i class="fas fa-file-excel"></i>
                                    Excel
                                </button>
                            </div>
                        </div>

                        <div class="revenue-stats">
                            <div class="revenue-card">
                                <div class="revenue-icon">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div class="revenue-info">
                                    <h4>$125,450</h4>
                                    <p>Total Revenue</p>
                                    <span class="growth positive">+15.2%</span>
                                </div>
                            </div>
                            <div class="revenue-card">
                                <div class="revenue-icon">
                                    <i class="fas fa-plane"></i>
                                </div>
                                <div class="revenue-info">
                                    <h4>$78,230</h4>
                                    <p>Flight Revenue</p>
                                    <span class="growth positive">+12.8%</span>
                                </div>
                            </div>
                            <div class="revenue-card">
                                <div class="revenue-icon">
                                    <i class="fas fa-train"></i>
                                </div>
                                <div class="revenue-info">
                                    <h4>$32,120</h4>
                                    <p>Train Revenue</p>
                                    <span class="growth positive">+18.5%</span>
                                </div>
                            </div>
                            <div class="revenue-card">
                                <div class="revenue-icon">
                                    <i class="fas fa-bus"></i>
                                </div>
                                <div class="revenue-info">
                                    <h4>$15,100</h4>
                                    <p>Bus Revenue</p>
                                    <span class="growth positive">+22.1%</span>
                                </div>
                            </div>
                        </div>

                        <div class="chart-container">
                            <canvas id="revenueChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Booking Analytics Tab -->
                <div class="tab-content" id="bookings">
                    <div class="report-section">
                        <div class="section-header">
                            <h3>Booking Performance</h3>
                            <div class="export-buttons">
                                <button class="btn btn-secondary" onclick="exportReport('bookings', 'pdf')">
                                    <i class="fas fa-file-pdf"></i>
                                    PDF
                                </button>
                                <button class="btn btn-secondary" onclick="exportReport('bookings', 'excel')">
                                    <i class="fas fa-file-excel"></i>
                                    Excel
                                </button>
                            </div>
                        </div>

                        <div class="booking-metrics">
                            <div class="metric-card">
                                <h4>2,450</h4>
                                <p>Total Bookings</p>
                                <div class="metric-chart">
                                    <canvas id="totalBookingsChart"></canvas>
                                </div>
                            </div>
                            <div class="metric-card">
                                <h4>89.5%</h4>
                                <p>Booking Success Rate</p>
                                <div class="metric-chart">
                                    <canvas id="successRateChart"></canvas>
                                </div>
                            </div>
                            <div class="metric-card">
                                <h4>12.3</h4>
                                <p>Avg. Days in Advance</p>
                                <div class="metric-chart">
                                    <canvas id="advanceBookingChart"></canvas>
                                </div>
                            </div>
                        </div>

                        <div class="popular-routes">
                            <h4>Top Routes by Bookings</h4>
                            <div class="routes-list">
                                <div class="route-item">
                                    <div class="route-info">
                                        <span class="route-name">Mumbai → Delhi</span>
                                        <span class="route-type">Flight</span>
                                    </div>
                                    <div class="route-stats">
                                        <span class="booking-count">450 bookings</span>
                                        <div class="progress-bar">
                                            <div class="progress" style="width: 90%"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="route-item">
                                    <div class="route-info">
                                        <span class="route-name">Delhi → Bangalore</span>
                                        <span class="route-type">Flight</span>
                                    </div>
                                    <div class="route-stats">
                                        <span class="booking-count">380 bookings</span>
                                        <div class="progress-bar">
                                            <div class="progress" style="width: 76%"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="route-item">
                                    <div class="route-info">
                                        <span class="route-name">Mumbai → Pune</span>
                                        <span class="route-type">Train</span>
                                    </div>
                                    <div class="route-stats">
                                        <span class="booking-count">320 bookings</span>
                                        <div class="progress-bar">
                                            <div class="progress" style="width: 64%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Customer Analytics Tab -->
                <div class="tab-content" id="customers">
                    <div class="report-section">
                        <div class="section-header">
                            <h3>Customer Insights</h3>
                            <div class="export-buttons">
                                <button class="btn btn-secondary" onclick="exportReport('customers', 'pdf')">
                                    <i class="fas fa-file-pdf"></i>
                                    PDF
                                </button>
                                <button class="btn btn-secondary" onclick="exportReport('customers', 'excel')">
                                    <i class="fas fa-file-excel"></i>
                                    Excel
                                </button>
                            </div>
                        </div>

                        <div class="customer-segments">
                            <div class="segment-card">
                                <div class="segment-header">
                                    <h4>Customer Segmentation</h4>
                                </div>
                                <div class="segment-chart">
                                    <canvas id="customerSegmentChart"></canvas>
                                </div>
                                <div class="segment-legend">
                                    <div class="legend-item">
                                        <span class="legend-color frequent"></span>
                                        <span>Frequent Travelers (35%)</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-color occasional"></span>
                                        <span>Occasional Travelers (45%)</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-color first-time"></span>
                                        <span>First-time Travelers (20%)</span>
                                    </div>
                                </div>
                            </div>

                            <div class="customer-stats">
                                <div class="stat-item">
                                    <h5>1,250</h5>
                                    <p>Active Customers</p>
                                </div>
                                <div class="stat-item">
                                    <h5>$102</h5>
                                    <p>Avg. Booking Value</p>
                                </div>
                                <div class="stat-item">
                                    <h5>3.2</h5>
                                    <p>Avg. Bookings/Customer</p>
                                </div>
                                <div class="stat-item">
                                    <h5>78%</h5>
                                    <p>Customer Retention</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Performance Tab -->
                <div class="tab-content" id="performance">
                    <div class="report-section">
                        <div class="section-header">
                            <h3>System Performance</h3>
                            <div class="export-buttons">
                                <button class="btn btn-secondary" onclick="exportReport('performance', 'pdf')">
                                    <i class="fas fa-file-pdf"></i>
                                    PDF
                                </button>
                                <button class="btn btn-secondary" onclick="exportReport('performance', 'excel')">
                                    <i class="fas fa-file-excel"></i>
                                    Excel
                                </button>
                            </div>
                        </div>

                        <div class="performance-metrics">
                            <div class="performance-card">
                                <div class="performance-icon">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <div class="performance-info">
                                    <h4>1.2s</h4>
                                    <p>Avg. Response Time</p>
                                    <span class="status good">Good</span>
                                </div>
                            </div>
                            <div class="performance-card">
                                <div class="performance-icon">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <div class="performance-info">
                                    <h4>99.8%</h4>
                                    <p>System Uptime</p>
                                    <span class="status excellent">Excellent</span>
                                </div>
                            </div>
                            <div class="performance-card">
                                <div class="performance-icon">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <div class="performance-info">
                                    <h4>0.2%</h4>
                                    <p>Error Rate</p>
                                    <span class="status good">Good</span>
                                </div>
                            </div>
                            <div class="performance-card">
                                <div class="performance-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="performance-info">
                                    <h4>1,450</h4>
                                    <p>Active Sessions</p>
                                    <span class="status normal">Normal</span>
                                </div>
                            </div>
                        </div>

                        <div class="performance-charts">
                            <div class="chart-container">
                                <h4>Response Time Trend</h4>
                                <canvas id="responseTimeChart"></canvas>
                            </div>
                            <div class="chart-container">
                                <h4>System Load</h4>
                                <canvas id="systemLoadChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="{{ url_for('static', filename='js/admin-reports.js') }}"></script>
</body>
</html>
